<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-grid.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-theme-alpine.css">
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-charts-enterprise@31.3.2/dist/ag-grid-charts-enterprise.js?t=1715777116725"></script>
</head>
<body>
    <div id="myGrid" class="ag-theme-alpine" style="height: 600px; width: 100%;"></div>
    <script>
        fetch('/data')
            .then(response => response.json())
            .then(data => {

                // DATA FORMATTING
                function numberFormatter(params) {
                var number = parseFloat(params.value);
                var formatted = number.toLocaleString('pt-BR', {minimumFractionDigits: 0});
                return `${formatted}`;
                }
                function dateFormatter(params) {
                var date = new Date(params.value);
                var formatted = date.toLocaleDateString('pt-BR');
                return formatted;
                }
                const rowData = data.map(item => ({
                    empresa: item.empresa,
                    data: item.data,
                    ano: item.ano,
                    mes: item.mes,
                    dia: item.dia,
                    registros: item.registros
                }));
                const gridOptions = {
                    columnDefs: [
                        { headerName: 'Empresa', field: 'empresa', enableRowGroup: true },
                        { headerName: 'Data', field: 'data' },
                        { headerName: 'Dia', field: 'dia'},
                        { headerName: 'Ano', field: 'ano', rowGroup: true, enableRowGroup: true, enablePivot: true },
                        { headerName: 'MÃªs', field: 'mes', rowGroup: true, enableRowGroup: true, enablePivot: true },
                        { headerName: 'Registros'
                            , field: 'registros'
                            , aggFunc: "sum"
                            , cellStyle: {
                                'text-align': 'right'
                            }
                            , valueFormatter: numberFormatter
                        }
                    ],
                    rowData,
                    rowGroupPanelShow: 'always',
                    sideBar: "columns",
                };
                const eGridDiv = document.querySelector('#myGrid');
                new agGrid.Grid(eGridDiv, gridOptions);
            });
    </script>
</body>
</html>
